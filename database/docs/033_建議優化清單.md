# 蘇打石器 — 建議優化清單

## ✅ 已完成的優化

| 項目 | 說明 |
|------|------|
| 攻略列表 | 不載入 content，點擊時再載入 |
| 攻略圖片 | lazy loading、上傳壓縮、PDF 轉檔優化 |
| Supabase | preconnect、AbortError 重試、anon 逾時 15s |
| 後台腳本 | Chart/Quill/Mammoth/PDF 等延遲載入 |
| 樂觀 UI | 會員、儲值、活動等頁面立即可見 |

---

## 🔧 建議優化（依優先度）

### 高優先度、易實作

#### 1. Realtime 延遲訂閱 ✅ 已實作
**現狀**：一進入網站就訂閱 donations、events、playlist、guides 四個 Realtime 頻道  
**已實作**：延遲 2 秒再訂閱，讓首屏資料先載入  
**效果**：減少首次載入時的連線數與資源

#### 2. unpkg dns-prefetch ✅ 已實作
**說明**：Babel 從 unpkg 載入，已加入 dns-prefetch 預先解析

#### 3. 字體 `font-display` ✅ 已設定
**說明**：Google Fonts URL 已含 `&display=swap`，優先顯示系統字體

#### 4. 靜態圖片尺寸
**建議**：為首頁 hero、LOGO 等 `<img>` 加上 `width`、`height`  
**效果**：減少版面位移（CLS），改善 Lighthouse 分數

---

### 中優先度、中等實作

#### 5. 攻略/活動 Skeleton 畫面
**建議**：載入時顯示灰色骨架，取代空白或 spinner  
**效果**：提升使用者覺得載入很快的感受

#### 6. Service Worker 策略調整
**建議**：對 `index.html` 用「Network first, fallback cache」，CDN 用「Stale-while-revalidate」  
**效果**：更新能即時生效，同時兼顧速度

#### 7. 攻略 Base64 圖片遷移到 Storage
**現狀**：攻略內容可能含大量 Base64 圖片，資料庫肥大  
**建議**：後台儲存時上傳到 Supabase Storage，改存 URL  
**效果**：縮小 DB 與 API 回應，載入更快（需較多開發）

---

### 低優先度、進階

#### 8. Supabase 專案保持活躍
**建議**：免費方案可透過定期 ping 避免暫停，或升級 Pro  
**效果**：減少冷啟動造成的 AbortError

#### 9. 首屏關鍵 CSS 內聯
**建議**：將首屏必要樣式 inline，其餘延遲載入  
**效果**：略加快 First Contentful Paint（需建置流程）

#### 10. 資料庫索引檢查
**建議**：對 `donations`、`guides` 常用查詢欄位檢查索引  
```sql
-- 檢查 guides 查詢
EXPLAIN ANALYZE SELECT * FROM guides WHERE status='published' ORDER BY is_pinned DESC, publish_date DESC;
```
**效果**：查詢時間穩定、較快

---

## 📊 效能檢查建議

1. **Chrome DevTools → Lighthouse**：跑 Performance、Best Practices
2. **Network**：觀察哪些請求最慢、體積最大
3. **Supabase Dashboard → Logs**：檢查慢查詢與錯誤
