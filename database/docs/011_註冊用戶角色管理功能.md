# 註冊用戶角色管理功能

## 更新內容

為「註冊用戶」列表新增了**快速設定角色**的功能，超級管理員可以直接在用戶列表中設定或變更用戶的角色。

## 新增功能

### 1. 操作按鈕
在用戶列表的每一行新增「操作」列，根據用戶當前角色顯示不同的操作按鈕：

#### 一般玩家（無角色）
- 🟡 **設為管理員**：將用戶升級為管理員
- 🟣 **設為超管**：將用戶直接升級為超級管理員

#### 管理員
- 🟣 **升為超管**：升級為超級管理員
- ⚪ **移除權限**：降為一般玩家

#### 超級管理員
- 🟡 **降為管理員**：降級為普通管理員

### 2. 安全機制
- ✅ **無法操作自己**：當前登入的超管無法修改自己的角色（顯示「本人」標記）
- ✅ **二次確認**：所有角色變更都會彈出確認對話框
- ✅ **即時更新**：角色變更後自動重新載入用戶列表
- ✅ **操作日誌**：設定管理員時會記錄到操作日誌

### 3. 用戶體驗
- 🎨 **按鈕顏色區分**：
  - 紫色 = 超管相關操作
  - 金色 = 管理員相關操作
  - 灰色 = 移除權限
- ✅ **即時反饋**：操作成功/失敗會顯示提示訊息
- ✅ **防誤操作**：所有變更都需要確認

## 使用方式

### 設定一般玩家為管理員
1. 找到目標用戶（角色顯示「一般玩家」）
2. 點擊「**設為管理員**」按鈕
3. 確認對話框中點擊「確定」
4. 用戶角色即時變更為「管理員」

### 設定一般玩家為超管
1. 找到目標用戶（角色顯示「一般玩家」）
2. 點擊「**設為超管**」按鈕
3. 確認對話框中點擊「確定」
4. 用戶角色即時變更為「超級管理員」

### 升級管理員為超管
1. 找到目標管理員（角色顯示「管理員」）
2. 點擊「**升為超管**」按鈕
3. 確認對話框中點擊「確定」
4. 用戶角色即時變更為「超級管理員」

### 降級或移除權限
1. 找到目標用戶
2. 點擊相應的按鈕（「降為管理員」或「移除權限」）
3. 確認對話框中點擊「確定」
4. 用戶角色即時變更

## 技術實現

### 前端
- 新增「操作」表格列
- 根據用戶角色動態顯示不同的操作按鈕
- 使用 `showConfirm` 進行二次確認
- 調用 `supabase.rpc('update_user_role')` 更新角色
- 操作完成後重新載入用戶列表

### 後端
- 複用現有的 `update_user_role()` RPC 函數
- 支援設定為 `admin`、`super_admin` 或 `null`（移除權限）
- `SECURITY DEFINER` 確保安全性

## 優勢

1. **操作便捷**：無需切換到「超管」標籤，直接在用戶列表操作
2. **一目了然**：可以看到所有用戶，快速找到目標
3. **功能齊全**：支援所有角色變更操作（升級、降級、移除）
4. **安全可靠**：二次確認 + 權限檢查 + 操作日誌

## 與「超管」標籤的區別

### 註冊用戶標籤
- 顯示**所有註冊用戶**（包括一般玩家）
- 可以**將一般玩家設為管理員**
- 可以**升級/降級/移除**任何用戶的角色
- 適合**查看所有用戶**並進行角色管理

### 超管標籤
- 只顯示**已有權限的管理員**
- 提供詳細的管理員資訊卡片
- 可以**編輯管理員資訊**
- 適合**管理現有管理員**

---

**更新時間**：2026-02-01  
**版本**：1.1.0
